#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <time.h>

#define MAX_WORDS 6000
#define WORD_LENGTH 5

// GLOBALS for loops to reduce clutter
int i, j;


// Loading dictionary from words.txt

int load_words(char words[][6]) {
    FILE *file = fopen("words.txt", "r");
    if (file == NULL) {
        printf("\nERROR: Could not open words.txt\n");
        return 0;
    }

    int count = 0;
    while (count < MAX_WORDS && fscanf(file, "%s", words[count]) != EOF) {
        if (strlen(words[count]) == WORD_LENGTH)
            count++;
    }

    fclose(file);
    return count;
}


// Checking if guess exists in list

int is_valid_word(char guess[], char words[][6], int total_words) {
    for (i = 0; i < total_words; i++) {
        if (strcmp(guess, words[i]) == 0)
            return 1;
    }
    return 0;
}


// Generating Wordle-style hint tags

void display_feedback(char guess[], char solution[], char output[]) {
    for (i = 0; i < WORD_LENGTH; i++) {
        if (guess[i] == solution[i]) {
            output[i] = '('; // correct spot
        } else {
            int found = 0;
            for (j = 0; j < WORD_LENGTH; j++) {
                if (guess[i] == solution[j]) {
                    found = 1;
                    break;
                }
            }
            if (found)
                output[i] = '[';  // wrong spot
            else
                output[i] = '{';  // not in word
        }
    }
}


// MAIN GAME

int main() {

    char words[MAX_WORDS][6];
    int total_words = load_words(words);

    if (total_words == 0) {
        return 0;
    }

    srand(time(NULL));  // This is required to give random seed each time for the rand function so the chosen word is always random
    char solution[6];
    strcpy(solution, words[rand() % total_words]);   // RANDOM WORD

    char wordle[6][5];  // stores what appears in the grid
    char guess[6];
    char marks[6];
    int again = 0, attempt;

    printf("Welcome to WORDLE!");
    printf("\n\n====== HOW TO PLAY ======");
    printf("\nGuess the 5-letter word in 6 tries.");
    printf("\n( ) = correct letter in correct place.");
    printf("\n[ ] = correct letter but wrong place.");
    printf("\n{ } = letter not in the word.");
    printf("\n\n====== BEGIN ======");

    printf("\n\nEnter 1 to play or 0 to exit: ");
    scanf("%d", &again);

    while (again == 1) {

        // clearing grid
        for (i = 0; i < 6; i++)
            for (j = 0; j < 5; j++)
                wordle[i][j] = '_';

        printf("\n====== GAME STARTED ======\n");

        // showing empty grid
        for (i = 0; i < 6; i++) {
            printf("      ");
            for (j = 0; j < 5; j++)
                printf("%c ", wordle[i][j]);
            printf("\n");
        }

        // gameplay loop
        for (attempt = 0; attempt < 6; attempt++) {

            printf("\nEnter guess %d: ", attempt + 1);
            scanf("%s", guess);

            // enforce 5 letters
            while (strlen(guess) != 5) {
                printf("Word must be exactly 5 letters. Try again: ");
                scanf("%s", guess);
            }

            // enforce english word
            while (!is_valid_word(guess, words, total_words)) {
                printf("Not a valid English word. Try again: ");
                scanf("%s", guess);
            }

            // give feedback
            display_feedback(guess, solution, marks);

            // update grid with guess letters
            for (j = 0; j < 5; j++)
                wordle[attempt][j] = guess[j];

            // show grid with progress
            printf("\nYour progress:\n\n");
            for (i = 0; i < 6; i++) {
                printf("      ");
                for (j = 0; j < 5; j++)
                    printf("%c ", wordle[i][j]);
                if (i == attempt) {
                    printf("   -> ");
                    for (j = 0; j < 5; j++) {
                        if (marks[j] == '(')
                            printf("(%c) ", guess[j]);
                        else if (marks[j] == '[')
                            printf("[%c] ", guess[j]);
                        else
                            printf("{%c} ", guess[j]);
                    }
                }
                printf("\n");
            }

            // check for win
            if (strcmp(guess, solution) == 0) {
                printf("\nCongratulations! You guessed the word: %s\n", solution);
                break;
            }
        }

        if (attempt == 6)
            printf("\nOut of attempts! The word was: %s\n", solution);

        printf("\nEnter 1 to play again or 0 to exit: ");
        scanf("%d", &again);

        if (again == 1) {
            strcpy(solution, words[rand() % total_words]);  // new random word
        }
    }

    return 0;
}
